<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>Nginxè¯¦ç»†æ•™ç¨‹ - è¿œæœ›ä¸–ç•Œ&#39; Blog</title><meta name="Description" content="è¿œæœ›ä¸–ç•Œ&#39; Blog"><meta property="og:url" content="https://blog.qiang.uk/2022/07/01/nginx%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/">
  <meta property="og:site_name" content="è¿œæœ›ä¸–ç•Œ&#39; Blog">
  <meta property="og:title" content="Nginxè¯¦ç»†æ•™ç¨‹">
  <meta property="og:description" content="ä¸€ã€Nginxä»‹ç» 1.1 å¼•è¨€ ä¸ºä»€ä¹ˆè¦å­¦ä¹ Nginx é—®é¢˜1ï¼šå®¢æˆ·ç«¯åˆ°åº•è¦å°†è¯·æ±‚å‘é€ç»™å“ªå°æœåŠ¡å™¨ é—®é¢˜2ï¼šå¦‚æœæ‰€æœ‰å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½å‘é€ç»™äº†æœåŠ¡å™¨ é—®é¢˜3ï¼š">
  <meta property="og:locale" content="zh_CN">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-07-01T00:00:00+00:00">
    <meta property="article:modified_time" content="2022-07-01T00:00:00+00:00">
    <meta property="article:tag" content="Nginx">
    <meta property="og:image" content="https://blog.qiang.uk/icons/avatar.png">

  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:image" content="https://blog.qiang.uk/icons/avatar.png">
  <meta name="twitter:title" content="Nginxè¯¦ç»†æ•™ç¨‹">
  <meta name="twitter:description" content="ä¸€ã€Nginxä»‹ç» 1.1 å¼•è¨€ ä¸ºä»€ä¹ˆè¦å­¦ä¹ Nginx é—®é¢˜1ï¼šå®¢æˆ·ç«¯åˆ°åº•è¦å°†è¯·æ±‚å‘é€ç»™å“ªå°æœåŠ¡å™¨ é—®é¢˜2ï¼šå¦‚æœæ‰€æœ‰å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½å‘é€ç»™äº†æœåŠ¡å™¨ é—®é¢˜3ï¼š">
<meta name="application-name" content="è¿œæœ›ä¸–ç•Œ&#39; Blog">
<meta name="apple-mobile-web-app-title" content="è¿œæœ›ä¸–ç•Œ&#39; Blog"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/icons/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/icons/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/icons/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png"><link rel="mask-icon" href="/icons/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/icons/site.webmanifest"><link rel="canonical" href="https://blog.qiang.uk/2022/07/01/nginx%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/" /><link rel="prev" href="https://blog.qiang.uk/2022/06/01/mybatisplus%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8/" /><link rel="next" href="https://blog.qiang.uk/2022/12/26/%E9%9A%8F%E6%9C%BA%E5%9B%BE%E7%89%87api/" /><link rel="stylesheet" href="/css/style.min.css"><link rel="preload" href="/lib/fontawesome-free/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/fontawesome-free/all.min.css"></noscript><link rel="preload" href="/lib/animate/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="/lib/animate/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Nginxè¯¦ç»†æ•™ç¨‹",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/blog.qiang.uk\/2022\/07\/01\/nginx%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B\/"
        },"genre": "posts","keywords": "Nginx","wordcount":  5500 ,
        "url": "https:\/\/blog.qiang.uk\/2022\/07\/01\/nginx%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B\/","datePublished": "2022-07-01T00:00:00+00:00","dateModified": "2022-07-01T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": ""},"author": {
                "@type": "Person",
                "name": "è¿œæœ›ä¸–ç•Œ"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="è¿œæœ›ä¸–ç•Œ&#39; Blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw' aria-hidden='true'></i></span>è¿œæœ›ä¸–ç•Œ&#39; Blog</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/"> ä¸»é¡µ </a><a class="menu-item" href="/posts/"> æ–‡ç«  </a><a class="menu-item" href="/categories/"> åˆ†ç±» </a><a class="menu-item" href="/tags/"> æ ‡ç­¾ </a><a class="menu-item" href="/about/"> å…³äº </a><a class="menu-item" href="https://memo.qiang.uk/" rel="noopener noreffer" target="_blank"> ğŸ“éšè®° </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="æœç´¢">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="è¿œæœ›ä¸–ç•Œ&#39; Blog"><span class="header-title-pre"><i class='far fa-kiss-wink-heart fa-fw' aria-hidden='true'></i></span>è¿œæœ›ä¸–ç•Œ&#39; Blog</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="æœç´¢æ–‡ç« æ ‡é¢˜æˆ–å†…å®¹..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="æœç´¢">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="æ¸…ç©º">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        å–æ¶ˆ
                    </a>
                </div><a class="menu-item" href="/" title="">ä¸»é¡µ</a><a class="menu-item" href="/posts/" title="">æ–‡ç« </a><a class="menu-item" href="/categories/" title="">åˆ†ç±»</a><a class="menu-item" href="/tags/" title="">æ ‡ç­¾</a><a class="menu-item" href="/about/" title="">å…³äº</a><a class="menu-item" href="https://memo.qiang.uk/" title="" rel="noopener noreffer" target="_blank">ğŸ“éšè®°</a><a href="javascript:void(0);" class="menu-item theme-switch" title="åˆ‡æ¢ä¸»é¢˜">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">ç›®å½•</h2>
            <div class="toc-content always-active" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Nginxè¯¦ç»†æ•™ç¨‹</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="https://github.com/yuanwangshijie" title="Author" target="_blank" rel="noopener noreffer author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>è¿œæœ›ä¸–ç•Œ</a></span>&nbsp;<span class="post-category">æ”¶å½•äº <a href="/categories/%E6%95%99%E7%A8%8B/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>æ•™ç¨‹</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2022-07-01">2022-07-01</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;çº¦ 5500 å­—&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;é¢„è®¡é˜…è¯» 11 åˆ†é’Ÿ&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>ç›®å½•</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#ä¸€nginxä»‹ç»">ä¸€ã€Nginxä»‹ç»</a>
      <ul>
        <li><a href="#11-å¼•è¨€">1.1 å¼•è¨€</a></li>
        <li><a href="#12-nginxä»‹ç»">1.2 Nginxä»‹ç»</a></li>
      </ul>
    </li>
    <li><a href="#äºŒnginxçš„å®‰è£…">äºŒã€Nginxçš„å®‰è£…</a>
      <ul>
        <li><a href="#21-å®‰è£…nginx">2.1 å®‰è£…Nginx</a></li>
        <li><a href="#22-nginxçš„é…ç½®æ–‡ä»¶">2.2 Nginxçš„é…ç½®æ–‡ä»¶</a></li>
        <li><a href="#23-ä¿®æ”¹docker-composeæ–‡ä»¶">2.3 ä¿®æ”¹docker-composeæ–‡ä»¶</a></li>
      </ul>
    </li>
    <li><a href="#ä¸‰nginxçš„åå‘ä»£ç†">ä¸‰ã€Nginxçš„åå‘ä»£ç†</a>
      <ul>
        <li><a href="#31-æ­£å‘ä»£ç†å’Œåå‘ä»£ç†ä»‹ç»">3.1 æ­£å‘ä»£ç†å’Œåå‘ä»£ç†ä»‹ç»</a></li>
        <li><a href="#32-åŸºäºnginxå®ç°åå‘ä»£ç†">3.2 åŸºäºNginxå®ç°åå‘ä»£ç†</a></li>
        <li><a href="#33-å…³äºnginxçš„locationè·¯å¾„æ˜ å°„">3.3 å…³äºNginxçš„locationè·¯å¾„æ˜ å°„</a></li>
      </ul>
    </li>
    <li><a href="#å››nginxè´Ÿè½½å‡è¡¡">å››ã€Nginxè´Ÿè½½å‡è¡¡</a>
      <ul>
        <li><a href="#41-è½®è¯¢">4.1 è½®è¯¢</a></li>
        <li><a href="#42-æƒé‡">4.2 æƒé‡</a></li>
        <li><a href="#43-ip_hash">4.3 ip_hash</a></li>
      </ul>
    </li>
    <li><a href="#äº”nginxåŠ¨é™åˆ†ç¦»">äº”ã€NginxåŠ¨é™åˆ†ç¦»</a>
      <ul>
        <li><a href="#51-åŠ¨æ€èµ„æºä»£ç†">5.1 åŠ¨æ€èµ„æºä»£ç†</a></li>
        <li><a href="#52-é™æ€èµ„æºä»£ç†">5.2 é™æ€èµ„æºä»£ç†</a></li>
      </ul>
    </li>
    <li><a href="#å…­nginxé›†ç¾¤">å…­ã€Nginxé›†ç¾¤</a>
      <ul>
        <li><a href="#61-å¼•è¨€">6.1 å¼•è¨€</a></li>
        <li><a href="#62-æ­å»º">6.2 æ­å»º</a></li>
      </ul>
    </li>
    <li><a href="#ä¸ƒå†…ç½®å˜é‡">ä¸ƒã€å†…ç½®å˜é‡</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><h2 id="ä¸€nginxä»‹ç»">ä¸€ã€Nginxä»‹ç»</h2>
<h3 id="11-å¼•è¨€">1.1 å¼•è¨€</h3>
<blockquote>
<p>ä¸ºä»€ä¹ˆè¦å­¦ä¹ <code>Nginx</code><br>
é—®é¢˜1ï¼šå®¢æˆ·ç«¯åˆ°åº•è¦å°†è¯·æ±‚å‘é€ç»™å“ªå°æœåŠ¡å™¨<br>
é—®é¢˜2ï¼šå¦‚æœæ‰€æœ‰å®¢æˆ·ç«¯çš„è¯·æ±‚éƒ½å‘é€ç»™äº†æœåŠ¡å™¨<br>
é—®é¢˜3ï¼šå®¢æˆ·ç«¯å‘é€çš„è¯·æ±‚å¯èƒ½æ˜¯ç”³è¯·åŠ¨æ€èµ„æºçš„ï¼Œä¹Ÿæœ‰ç”³è¯·é™æ€èµ„æºçš„<br></p>
</blockquote>
<p><strong>æœåŠ¡å™¨æ­å»ºé›†ç¾¤å</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://minio.qiang.uk/static/2023/05/15/7179424959c8ad4167cf68d69bbd4ea5.png"
        data-srcset="https://minio.qiang.uk/static/2023/05/15/7179424959c8ad4167cf68d69bbd4ea5.png, https://minio.qiang.uk/static/2023/05/15/7179424959c8ad4167cf68d69bbd4ea5.png 1.5x, https://minio.qiang.uk/static/2023/05/15/7179424959c8ad4167cf68d69bbd4ea5.png 2x"
        data-sizes="auto"
        alt="https://minio.qiang.uk/static/2023/05/15/7179424959c8ad4167cf68d69bbd4ea5.png"
        title="https://minio.qiang.uk/static/2023/05/15/7179424959c8ad4167cf68d69bbd4ea5.png" /></p>
<p><strong>åœ¨æ­å»ºé›†ç¾¤åï¼Œä½¿ç”¨Nginxåšåå‘ä»£ç†</strong></p>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://minio.qiang.uk/static/2023/05/15/117f0fde1b4510eb26482d28f197cd58.png"
        data-srcset="https://minio.qiang.uk/static/2023/05/15/117f0fde1b4510eb26482d28f197cd58.png, https://minio.qiang.uk/static/2023/05/15/117f0fde1b4510eb26482d28f197cd58.png 1.5x, https://minio.qiang.uk/static/2023/05/15/117f0fde1b4510eb26482d28f197cd58.png 2x"
        data-sizes="auto"
        alt="https://minio.qiang.uk/static/2023/05/15/117f0fde1b4510eb26482d28f197cd58.png"
        title="https://minio.qiang.uk/static/2023/05/15/117f0fde1b4510eb26482d28f197cd58.png" /></p>
<h3 id="12-nginxä»‹ç»">1.2 Nginxä»‹ç»</h3>
<p><code>Nginx</code>æ˜¯ç”±ä¿„ç½—æ–¯äººç ”å‘çš„ï¼Œåº”å¯¹<code>Rambler</code>çš„ç½‘ç«™å¹¶å‘ï¼Œå¹¶ä¸”2004å¹´å‘å¸ƒçš„ç¬¬ä¸€ä¸ªç‰ˆæœ¬</p>
<blockquote>
<p><strong>Nginxçš„ç‰¹ç‚¹</strong></p>
<ol>
<li>ç¨³å®šæ€§æå¼ºï¼Œ7*24å°æ—¶ä¸é—´æ–­è¿è¡Œ(å°±æ˜¯ä¸€ç›´è¿è¡Œ)</li>
<li>Nginxæä¾›äº†éå¸¸ä¸°å¯Œçš„é…ç½®å®ä¾‹</li>
<li>å ç”¨å†…å­˜å°ï¼Œå¹¶å‘èƒ½åŠ›å¼ºï¼ˆéšä¾¿é…ç½®ä¸€ä¸‹å°±æ˜¯5w+ï¼Œè€Œtomcatçš„é»˜è®¤çº¿ç¨‹æ± æ˜¯150ï¼‰</li>
</ol>
</blockquote>
<h2 id="äºŒnginxçš„å®‰è£…">äºŒã€Nginxçš„å®‰è£…</h2>
<h3 id="21-å®‰è£…nginx">2.1 å®‰è£…Nginx</h3>
<p>ä½¿ç”¨<code>docker-compose</code>å®‰è£…</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">#åœ¨/optç›®å½•ä¸‹åˆ›å»ºdocker_nginxç›®å½•
</span></span><span class="line"><span class="cl">cd /opt
</span></span><span class="line"><span class="cl">mkdir docker_nginx
</span></span><span class="line"><span class="cl">#åˆ›å»ºdocker-compose.ymlæ–‡ä»¶å¹¶ç¼–å†™ä¸‹é¢çš„å†…å®¹,ä¿å­˜é€€å‡º
</span></span><span class="line"><span class="cl">vim docker-compose.yml
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">version: &#39;3.1&#39;
</span></span><span class="line"><span class="cl">services: 
</span></span><span class="line"><span class="cl">  nginx:
</span></span><span class="line"><span class="cl">    restart: always
</span></span><span class="line"><span class="cl">    image: daocloud.io/library/nginx:latest
</span></span><span class="line"><span class="cl">    container_name: nginx
</span></span><span class="line"><span class="cl">    ports: 
</span></span><span class="line"><span class="cl">      - 80:80
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">æ‰§è¡Œdocker-compose up -d
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="22-nginxçš„é…ç½®æ–‡ä»¶">2.2 Nginxçš„é…ç½®æ–‡ä»¶</h3>
<p><code>Nginx</code>çš„æ ¸å¿ƒé…ç½®æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># æŸ¥çœ‹å½“å‰nginxçš„é…ç½®éœ€è¦è¿›å…¥dockerå®¹å™¨ä¸­
</span></span><span class="line"><span class="cl">docker exec -it å®¹å™¨id bash
</span></span><span class="line"><span class="cl"># è¿›å…¥å®¹å™¨å
</span></span><span class="line"><span class="cl">cd /etc/nginx/
</span></span><span class="line"><span class="cl">cat nginx.conf
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>nginx.conf</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">user</span>  <span class="n">nginx</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">worker_processes</span>  <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">error_log</span>  <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">error</span><span class="o">.</span><span class="n">log</span> <span class="n">warn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">pid</span>        <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="n">nginx</span><span class="o">.</span><span class="n">pid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="c1"># ä»¥ä¸ŠåŒç§°ä¸ºå…¨å±€å—</span>
</span></span><span class="line"><span class="cl"><span class="c1"># worker_processesçš„æ•°å€¼è¶Šå¤§ï¼ŒNginxçš„å¹¶å‘èƒ½åŠ›å°±è¶Šå¼º</span>
</span></span><span class="line"><span class="cl"><span class="c1"># error_logä»£è¡¨Nginxé”™è¯¯æ—¥å¿—å­˜æ”¾çš„ä½ç½®</span>
</span></span><span class="line"><span class="cl"><span class="c1"># pidæ˜¯Nginxè¿è¡Œçš„ä¸€ä¸ªæ ‡è¯†</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">events</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">worker_connections</span>  <span class="mi">1024</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1"># eventså—</span>
</span></span><span class="line"><span class="cl"><span class="c1"># worker_connectionsçš„æ•°å€¼è¶Šå¤§ï¼ŒNginxçš„å¹¶å‘èƒ½åŠ›å°±è¶Šå¼º</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">http</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">include</span>       <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">mime</span><span class="o">.</span><span class="n">types</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">default_type</span>  <span class="n">application</span><span class="o">/</span><span class="n">octet</span><span class="o">-</span><span class="n">stream</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">log_format</span>  <span class="n">main</span>  <span class="s1">&#39;$remote_addr - $remote_user [$time_local] &#34;$request&#34; &#39;</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;$status $body_bytes_sent &#34;$http_referer&#34; &#39;</span>
</span></span><span class="line"><span class="cl">                      <span class="s1">&#39;&#34;$http_user_agent&#34; &#34;$http_x_forwarded_for&#34;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">access_log</span>  <span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">access</span><span class="o">.</span><span class="n">log</span>  <span class="n">main</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">sendfile</span>        <span class="n">on</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#tcp_nopush     on;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">keepalive_timeout</span>  <span class="mi">65</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#gzip  on;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">include</span> <span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">conf</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">conf</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># httpå—</span>
</span></span><span class="line"><span class="cl"><span class="c1"># include ä»£è¡¨å¼•å…¥ä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶</span>
</span></span><span class="line"><span class="cl"><span class="c1"># include /etc/nginx/mime.types;    mime.typesä¸­å­˜æ”¾ç€å¤§é‡åª’ä½“ç±»å‹</span>
</span></span><span class="line"><span class="cl"><span class="c1"># include /etc/nginx/conf.d/*.conf; å¼•å…¥äº†conf.dä¸‹ä»¥.confä¸ºç»“å°¾çš„é…ç½®æ–‡ä»¶</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>conf.d</code>ç›®å½•ä¸‹åªæœ‰ä¸€ä¸ª<code>default.conf</code>æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-gdscript3" data-lang="gdscript3"><span class="line"><span class="cl"><span class="n">server</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">listen</span>       <span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">listen</span>  <span class="p">[::]:</span><span class="mi">80</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">server_name</span>  <span class="n">localhost</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">#charset koi8-r;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#access_log  /var/log/nginx/host.access.log  main;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">location</span> <span class="o">/</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">root</span>   <span class="o">/</span><span class="n">usr</span><span class="o">/</span><span class="n">share</span><span class="o">/</span><span class="n">nginx</span><span class="o">/</span><span class="n">html</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">index</span>  <span class="n">index</span><span class="o">.</span><span class="n">html</span> <span class="n">index</span><span class="o">.</span><span class="n">htm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># locationå—</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># root:å°†æ¥å—åˆ°çš„è¯·æ±‚æ ¹æ®/usr/share/nginx/htmlå»æŸ¥æ‰¾é™æ€èµ„æº</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># index:é»˜è®¤å»ä¸Šè¿°çš„è·¯å¾„ä¸­æ‰¾åˆ°index.htmlæˆ–index.htm</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># serverå—</span>
</span></span><span class="line"><span class="cl"><span class="c1"># listenä»£è¡¨Nginxç›‘å¬çš„ç«¯å£å·</span>
</span></span><span class="line"><span class="cl"><span class="c1"># server_nameä»£è¡¨Nginxæ¥å—è¯·æ±‚çš„IP</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="23-ä¿®æ”¹docker-composeæ–‡ä»¶">2.3 ä¿®æ”¹docker-composeæ–‡ä»¶</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># é€€å‡ºå®¹å™¨
</span></span><span class="line"><span class="cl">exit
</span></span><span class="line"><span class="cl"># å…³é—­å®¹å™¨
</span></span><span class="line"><span class="cl">docker-compose down
</span></span><span class="line"><span class="cl"># ä¿®æ”¹docker-compose.ymlæ–‡ä»¶å¦‚ä¸‹
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">version: &#39;3.1&#39;
</span></span><span class="line"><span class="cl">services: 
</span></span><span class="line"><span class="cl">  nginx:
</span></span><span class="line"><span class="cl">    restart: always
</span></span><span class="line"><span class="cl">    image: daocloud.io/library/nginx:latest
</span></span><span class="line"><span class="cl">    container_name: nginx
</span></span><span class="line"><span class="cl">    ports: 
</span></span><span class="line"><span class="cl">      - 80:80
</span></span><span class="line"><span class="cl">    volumes:
</span></span><span class="line"><span class="cl">      - /opt/docker_nginx/conf.d/:/etc/nginx/conf.d
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># é‡æ–°æ„å»ºå®¹å™¨
</span></span><span class="line"><span class="cl">docker-compose bulid
</span></span><span class="line"><span class="cl"># é‡æ–°å¯åŠ¨å®¹å™¨
</span></span><span class="line"><span class="cl">docker-compose up -d
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ—¶æˆ‘ä»¬å†æ¬¡è®¿é—®<code>80</code>ç«¯å£æ˜¯è®¿é—®ä¸åˆ°çš„ï¼Œå› ä¸ºæˆ‘ä»¬æ˜ å°„äº†æ•°æ®å·ä¹‹åè¿˜æ²¡æœ‰ç¼–å†™<code>server</code>å—ä¸­çš„å†…å®¹</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬åœ¨<code>/opt/docker_nginx/conf.d</code>ä¸‹æ–°å»º<code>default.conf</code>ï¼Œå¹¶æ’å…¥å¦‚ä¸‹å†…å®¹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">    listen       80;
</span></span><span class="line"><span class="cl">    listen  [::]:80;
</span></span><span class="line"><span class="cl">    server_name  localhost;
</span></span><span class="line"><span class="cl">    location / {
</span></span><span class="line"><span class="cl">        root   /usr/share/nginx/html;
</span></span><span class="line"><span class="cl">        index  index.html index.htm;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># é‡å¯nginx
</span></span><span class="line"><span class="cl">docker-compose restart
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸‰nginxçš„åå‘ä»£ç†">ä¸‰ã€Nginxçš„åå‘ä»£ç†</h2>
<h3 id="31-æ­£å‘ä»£ç†å’Œåå‘ä»£ç†ä»‹ç»">3.1 æ­£å‘ä»£ç†å’Œåå‘ä»£ç†ä»‹ç»</h3>
<blockquote>
<p>æ­£å‘ä»£ç†ï¼š</p>
<ol>
<li>æ­£å‘ä»£ç†æœåŠ¡æ˜¯ç”±å®¢æˆ·ç«¯è®¾ç«‹çš„</li>
<li>å®¢æˆ·ç«¯äº†è§£ä»£ç†æœåŠ¡å™¨å’Œç›®æ ‡æœåŠ¡å™¨éƒ½æ˜¯è°</li>
<li>å¸®åŠ©å’±ä»¬å®ç°çªç ´è®¿é—®æƒé™ï¼Œæé«˜è®¿é—®çš„é€Ÿåº¦ï¼Œå¯¹ç›®æ ‡æœåŠ¡å™¨éšè—å®¢æˆ·ç«¯çš„ipåœ°å€</li>
</ol>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://minio.qiang.uk/static/2023/05/15/6345c4de022284687b194f721190746e.png"
        data-srcset="https://minio.qiang.uk/static/2023/05/15/6345c4de022284687b194f721190746e.png, https://minio.qiang.uk/static/2023/05/15/6345c4de022284687b194f721190746e.png 1.5x, https://minio.qiang.uk/static/2023/05/15/6345c4de022284687b194f721190746e.png 2x"
        data-sizes="auto"
        alt="https://minio.qiang.uk/static/2023/05/15/6345c4de022284687b194f721190746e.png"
        title="https://minio.qiang.uk/static/2023/05/15/6345c4de022284687b194f721190746e.png" /></p>
<blockquote>
<p>åå‘ä»£ç†ï¼š</p>
<ol>
<li>åå‘ä»£ç†æœåŠ¡å™¨æ˜¯é…ç½®åœ¨æœåŠ¡ç«¯çš„</li>
<li>å®¢æˆ·ç«¯ä¸çŸ¥é“è®¿é—®çš„åˆ°åº•æ˜¯å“ªä¸€å°æœåŠ¡å™¨</li>
<li>è¾¾åˆ°è´Ÿè½½å‡è¡¡ï¼Œå¹¶ä¸”å¯ä»¥éšè—æœåŠ¡å™¨çœŸæ­£çš„ipåœ°å€</li>
</ol>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://minio.qiang.uk/static/2023/05/15/21117a693cfa213840e7e732a134ce54.png"
        data-srcset="https://minio.qiang.uk/static/2023/05/15/21117a693cfa213840e7e732a134ce54.png, https://minio.qiang.uk/static/2023/05/15/21117a693cfa213840e7e732a134ce54.png 1.5x, https://minio.qiang.uk/static/2023/05/15/21117a693cfa213840e7e732a134ce54.png 2x"
        data-sizes="auto"
        alt="https://minio.qiang.uk/static/2023/05/15/21117a693cfa213840e7e732a134ce54.png"
        title="https://minio.qiang.uk/static/2023/05/15/21117a693cfa213840e7e732a134ce54.png" /></p>
<h3 id="32-åŸºäºnginxå®ç°åå‘ä»£ç†">3.2 åŸºäºNginxå®ç°åå‘ä»£ç†</h3>
<blockquote>
<ol>
<li>å‡†å¤‡ä¸€ä¸ªç›®æ ‡æœåŠ¡å™¨</li>
<li>å¯åŠ¨tomcatæœåŠ¡å™¨</li>
<li>ç¼–å†™nginxçš„é…ç½®æ–‡ä»¶(/opt/docker_nginx/conf.d/default.conf)ï¼Œé€šè¿‡Nginxè®¿é—®åˆ°tomcatæœåŠ¡å™¨</li>
</ol>
</blockquote>
<p>å‡†å¤‡<code>Tomcat</code>æœåŠ¡å™¨</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">docker run -d -p 8080:8080 --name tomcat  daocloud.io/library/tomcat:8.5.15-jre8
</span></span><span class="line"><span class="cl">#æˆ–è€…å·²ç»ä¸‹è½½äº†tomcaté•œåƒ
</span></span><span class="line"><span class="cl">docker run -d -p 8080:8080 --name tomcat é•œåƒçš„æ ‡è¯†
</span></span><span class="line"><span class="cl">#æ·»åŠ æ•°æ®å·
</span></span><span class="line"><span class="cl">docker run -it -v /å®¿ä¸»æœºç»å¯¹ç›®å½•:/å®¹å™¨å†…ç›®å½• é•œåƒå
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>default.conf</code>æ–‡ä»¶å†…å®¹å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">    listen       80;
</span></span><span class="line"><span class="cl">    listen  [::]:80;
</span></span><span class="line"><span class="cl">    server_name  localhost;
</span></span><span class="line"><span class="cl">    # åŸºäºåå‘ä»£ç†è®¿é—®TomcatæœåŠ¡å™¨
</span></span><span class="line"><span class="cl">    location / {
</span></span><span class="line"><span class="cl">        proxy_pass http://IP:8080/;
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># é‡å¯nginx 
</span></span><span class="line"><span class="cl">docker-compose restart
</span></span></code></pre></td></tr></table>
</div>
</div><p>è¿™æ—¶æˆ‘ä»¬è®¿é—®<code>80</code>ç«¯å£å¯ä»¥çœ‹åˆ°<code>8080</code>ç«¯å£tomcatçš„é»˜è®¤é¦–é¡µ</p>
<h3 id="33-å…³äºnginxçš„locationè·¯å¾„æ˜ å°„">3.3 å…³äºNginxçš„locationè·¯å¾„æ˜ å°„</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">ä¼˜å…ˆçº§å…³ç³»ï¼š
</span></span><span class="line"><span class="cl">(location = ) 
</span></span><span class="line"><span class="cl">    &gt; (location /xxx/yyy/zzz) 
</span></span><span class="line"><span class="cl">    &gt; (location ^~) 
</span></span><span class="line"><span class="cl">    &gt; (location ~,~*) 
</span></span><span class="line"><span class="cl">    &gt; (location /èµ·å§‹è·¯å¾„) 
</span></span><span class="line"><span class="cl">    &gt; (location /)
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 1. = åŒ¹é…
</span></span><span class="line"><span class="cl">location / {
</span></span><span class="line"><span class="cl">    # ç²¾å‡†åŒ¹é…ï¼Œä¸»æœºååé¢ä¸èƒ½å¸¦èƒ½å’Œå­—ç¬¦ä¸²
</span></span><span class="line"><span class="cl">    # ä¾‹å¦‚www.baidu.comä¸èƒ½æ˜¯www.baidu.com/id=xxx
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 2. é€šç”¨åŒ¹é…
</span></span><span class="line"><span class="cl">location /xxx {
</span></span><span class="line"><span class="cl">    # åŒ¹é…æ‰€æœ‰ä»¥/xxxå¼€å¤´çš„è·¯å¾„
</span></span><span class="line"><span class="cl">    # ä¾‹å¦‚127.0.0.1:8080/xxx  xxxå¯ä»¥ä¸ºç©ºï¼Œä¸ºç©ºåˆ™å’Œ=åŒ¹é…ä¸€æ ·
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 3. æ­£åˆ™åŒ¹é…
</span></span><span class="line"><span class="cl">location ~ /xxx {
</span></span><span class="line"><span class="cl">    # åŒ¹é…æ‰€æœ‰ä»¥/xxxå¼€å¤´çš„è·¯å¾„
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 4. åŒ¹é…å¼€å¤´è·¯å¾„
</span></span><span class="line"><span class="cl">location ^~ /xxx/xx {
</span></span><span class="line"><span class="cl">    # åŒ¹é…æ‰€æœ‰ä»¥/xxx/xxå¼€å¤´çš„è·¯å¾„
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># 5. åŒ¹é…ç»“å°¾è·¯å¾„
</span></span><span class="line"><span class="cl">location ~* \.(gif/jpg/png)$ {
</span></span><span class="line"><span class="cl">    # åŒ¹é…ä»¥.gifã€.jpgæˆ–è€….pngç»“å°¾çš„è·¯å¾„
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p>ä¿®æ”¹<code>/opt/docker_nginx/conf.d/default.conf</code>å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">    listen       80;
</span></span><span class="line"><span class="cl">    listen  [::]:80;
</span></span><span class="line"><span class="cl">    server_name  localhost;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    location /index {
</span></span><span class="line"><span class="cl">        proxy_pass http://IP:8081/; # Aé¦–é¡µ
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    location ^~ /mall/ {
</span></span><span class="line"><span class="cl">        proxy_pass http://IP:8080/; # Bé¦–é¡µ
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    location / {
</span></span><span class="line"><span class="cl">        proxy_pass http://IP:8080/; # Cé¦–é¡µ
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">docker-compose restart
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å››nginxè´Ÿè½½å‡è¡¡">å››ã€Nginxè´Ÿè½½å‡è¡¡</h2>
<blockquote>
<p>Nginxä¸ºæˆ‘ä»¬é»˜è®¤æä¾›äº†ä¸‰ç§è´Ÿè½½å‡è¡¡çš„ç­–ç•¥ï¼š</p>
<ol>
<li>è½®è¯¢ï¼š å°†å®¢æˆ·ç«¯å‘èµ·çš„è¯·æ±‚ï¼Œå¹³å‡åˆ†é…ç»™æ¯ä¸€å°æœåŠ¡å™¨</li>
<li>æƒé‡ï¼š ä¼šå°†å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œæ ¹æ®æœåŠ¡å™¨çš„æƒé‡å€¼ä¸åŒï¼Œåˆ†é…ä¸åŒçš„æ•°é‡</li>
<li>ip_hash: åŸºäºå‘èµ·è¯·æ±‚çš„å®¢æˆ·ç«¯çš„ipåœ°å€ä¸åŒï¼Œä»–å§‹ç»ˆä¼šå°†è¯·æ±‚å‘é€åˆ°æŒ‡å®šçš„æœåŠ¡å™¨ä¸Š å°±æ˜¯è¯´å¦‚æœè¿™ä¸ªå®¢æˆ·ç«¯çš„è¯·æ±‚çš„ipåœ°å€ä¸å˜ï¼Œé‚£ä¹ˆå¤„ç†è¯·æ±‚çš„æœåŠ¡å™¨å°†ä¸€ç›´æ˜¯åŒä¸€ä¸ª</li>
</ol>
</blockquote>
<h3 id="41-è½®è¯¢">4.1 è½®è¯¢</h3>
<p>æƒ³å®ç°<code>è½®è¯¢</code>è´Ÿè½½å‡è¡¡æœºåˆ¶åªéœ€è¦ä¿®æ”¹é…ç½®æ–‡ä»¶å¦‚ä¸‹</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">upstream my_server{
</span></span><span class="line"><span class="cl">    server IP:8080;
</span></span><span class="line"><span class="cl">    server IP:8081;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">    listen       80;
</span></span><span class="line"><span class="cl">    listen  [::]:80;
</span></span><span class="line"><span class="cl">    server_name  localhost;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    location / {
</span></span><span class="line"><span class="cl">        proxy_pass http://my_server/;   #Tomcaté¦–é¡µ
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="42-æƒé‡">4.2 æƒé‡</h3>
<p>å®ç°<code>æƒé‡</code>çš„æ–¹å¼ï¼šåœ¨é…ç½®æ–‡ä»¶ä¸­<code>upstream</code>å—ä¸­åŠ ä¸Š<code>weight</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">upstream my_server{
</span></span><span class="line"><span class="cl">    server IP:8080 weight=10;
</span></span><span class="line"><span class="cl">    server IP:8081 weight=2;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">    listen       80;
</span></span><span class="line"><span class="cl">    listen  [::]:80;
</span></span><span class="line"><span class="cl">    server_name  localhost;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    location / {
</span></span><span class="line"><span class="cl">        proxy_pass http://my_server/;   #Tomcaté¦–é¡µ
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="43-ip_hash">4.3 ip_hash</h3>
<p>å®ç°<code>ip_hash</code>æ–¹å¼ï¼šåœ¨é…ç½®æ–‡ä»¶<code>upstream</code>å—ä¸­åŠ ä¸Š<code>ip_hash</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">upstream my_server{
</span></span><span class="line"><span class="cl">    ip_hash;
</span></span><span class="line"><span class="cl">    server IP:8080 weight=10;
</span></span><span class="line"><span class="cl">    server IP:8081 weight=2;
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">server {
</span></span><span class="line"><span class="cl">    listen       80;
</span></span><span class="line"><span class="cl">    listen  [::]:80;
</span></span><span class="line"><span class="cl">    server_name  localhost;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    location / {
</span></span><span class="line"><span class="cl">        proxy_pass http://my_server/;   #Tomcaté¦–é¡µ
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="äº”nginxåŠ¨é™åˆ†ç¦»">äº”ã€NginxåŠ¨é™åˆ†ç¦»</h2>
<blockquote>
<p>Nginxçš„å¹¶å‘èƒ½åŠ›å…¬å¼ï¼š <code>worker_processes</code> * <code>worker_connections</code> / (4 or 2)ï¼ŒåŠ¨æ€èµ„æºéœ€è¦/4ï¼Œé™æ€èµ„æºéœ€è¦/2<br>
Nginxé€šè¿‡åŠ¨é™åˆ†ç¦»æ¥æå‡Nginxçš„å¹¶å‘èƒ½åŠ›ï¼Œæ›´å¿«çš„ç»™ç”¨æˆ·å“åº”</p>
</blockquote>
<h3 id="51-åŠ¨æ€èµ„æºä»£ç†">5.1 åŠ¨æ€èµ„æºä»£ç†</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># é…ç½®å¦‚ä¸‹
</span></span><span class="line"><span class="cl">location / {
</span></span><span class="line"><span class="cl">  proxy_pass è·¯å¾„;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="52-é™æ€èµ„æºä»£ç†">5.2 é™æ€èµ„æºä»£ç†</h3>
<p>å…ˆä¿®æ”¹<code>docker-compose</code>æ–‡ä»¶</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">version: &#39;3.1&#39;
</span></span><span class="line"><span class="cl">services: 
</span></span><span class="line"><span class="cl">  nginx:
</span></span><span class="line"><span class="cl">    restart: always
</span></span><span class="line"><span class="cl">    image: daocloud.io/library/nginx:latest
</span></span><span class="line"><span class="cl">    container_name: nginx
</span></span><span class="line"><span class="cl">    ports: 
</span></span><span class="line"><span class="cl">      - 80:80
</span></span><span class="line"><span class="cl">    volumes:
</span></span><span class="line"><span class="cl">      - /opt/docker_nginx/conf.d/:/etc/nginx/conf.d
</span></span><span class="line"><span class="cl">      - /opt/docker_nginx/html/:/usr/share/nginx/html
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># åœ¨/opt/docker_nginx/htmlä¸‹æ–°å»ºä¸€ä¸ªindex.html
</span></span><span class="line"><span class="cl"># åœ¨index.htmlé‡Œé¢éšä¾¿å†™ç‚¹ä¸œè¥¿å±•ç¤º
</span></span><span class="line"><span class="cl"># ä¿®æ”¹nginxçš„é…ç½®æ–‡ä»¶
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">location / {
</span></span><span class="line"><span class="cl">    root /usr/share/nginx/html;
</span></span><span class="line"><span class="cl">    index index.html;
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># é…ç½®å¦‚ä¸‹
</span></span><span class="line"><span class="cl">location / {
</span></span><span class="line"><span class="cl">    root é™æ€èµ„æºè·¯å¾„;
</span></span><span class="line"><span class="cl">    index é»˜è®¤è®¿é—®è·¯å¾„ä¸‹çš„ä»€ä¹ˆèµ„æº;
</span></span><span class="line"><span class="cl">    autoindex on; # ä»£è¡¨å±•ç¤ºé™æ€èµ„æºçš„å…¨éƒ¨å†…å®¹ï¼Œä»¥åˆ—è¡¨çš„å½¢å¼å±•å¼€
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># é‡å¯nginx
</span></span><span class="line"><span class="cl">docker-compose restart
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="å…­nginxé›†ç¾¤">å…­ã€Nginxé›†ç¾¤</h2>
<h3 id="61-å¼•è¨€">6.1 å¼•è¨€</h3>
<blockquote>
<p>ç›®çš„ï¼šé¿å…å•ç‚¹nginxçš„å®•æœºï¼Œå¯¼è‡´æ•´ä¸ªç¨‹åºçš„å´©æºƒ</p>
<ul>
<li>å‡†å¤‡å¤šå°nginx</li>
<li>å‡†å¤‡keepalivedï¼Œç›‘å¬nginxçš„å¥åº·æƒ…å†µ</li>
<li>å‡†å¤‡haproxyï¼Œæä¾›ä¸€ä¸ªè™šæ‹Ÿçš„è·¯å¾„ï¼Œç»Ÿä¸€çš„å»æ¥æ”¶ç”¨æˆ·çš„è¯·æ±‚</li>
</ul>
</blockquote>
<p><img
        class="lazyload"
        src="/svg/loading.min.svg"
        data-src="https://minio.qiang.uk/static/2023/05/15/c06f3f566b0fa3ced92316763989e951.png"
        data-srcset="https://minio.qiang.uk/static/2023/05/15/c06f3f566b0fa3ced92316763989e951.png, https://minio.qiang.uk/static/2023/05/15/c06f3f566b0fa3ced92316763989e951.png 1.5x, https://minio.qiang.uk/static/2023/05/15/c06f3f566b0fa3ced92316763989e951.png 2x"
        data-sizes="auto"
        alt="https://minio.qiang.uk/static/2023/05/15/c06f3f566b0fa3ced92316763989e951.png"
        title="https://minio.qiang.uk/static/2023/05/15/c06f3f566b0fa3ced92316763989e951.png" /></p>
<h3 id="62-æ­å»º">6.2 æ­å»º</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl"># å…ˆå‡†å¤‡å¥½ä»¥ä¸‹æ–‡ä»¶æ”¾å…¥/opt/docker_nginx_clusterç›®å½•ä¸­
</span></span><span class="line"><span class="cl"># ç„¶åå¯åŠ¨å®¹å™¨    æ³¨æ„ç¡®ä¿80ã€8081å’Œ8082ç«¯å£æœªè¢«å ç”¨(æˆ–è€…ä¿®æ”¹docker-compose.ymlä¸­çš„ç«¯å£)
</span></span><span class="line"><span class="cl">docker-compose up -d
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"># ç„¶åæˆ‘ä»¬è®¿é—®8081ç«¯å£å¯ä»¥çœ‹åˆ°masterï¼Œè®¿é—®8082ç«¯å£å¯ä»¥çœ‹åˆ°slave
</span></span><span class="line"><span class="cl"># å› ä¸ºæˆ‘ä»¬è®¾ç½®äº†81ç«¯å£çš„masterä¼˜å…ˆçº§æœª200æ¯”82ç«¯å£çš„slaveä¼˜å…ˆçº§100é«˜ï¼Œæ‰€ä»¥æˆ‘ä»¬è®¿é—®80ç«¯å£çœ‹åˆ°çš„æ˜¯master
</span></span><span class="line"><span class="cl"># ç°åœ¨æˆ‘ä»¬æ¨¡ä»¿8081ç«¯å£çš„nginxå®•æœºäº†
</span></span><span class="line"><span class="cl"># docker stop 8081ç«¯å£nginxå®¹å™¨çš„ID
</span></span><span class="line"><span class="cl"># è¿™æ—¶æˆ‘ä»¬å†å»è®¿é—®80ç«¯å£çœ‹åˆ°çš„å°±æ˜¯slaveäº†
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>Dockerfile</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">FROM nginx:1.13.5-alpine
</span></span><span class="line"><span class="cl">RUN apk update &amp;&amp; apk upgrade
</span></span><span class="line"><span class="cl">RUN apk add --no-cache bash curl ipvsadm iproute2 openrc keepalived
</span></span><span class="line"><span class="cl">COPY entrypoint.sh /entrypoint.sh
</span></span><span class="line"><span class="cl">RUN chmod +x /entrypoint.sh
</span></span><span class="line"><span class="cl">CMD [&#34;/entrypoint.sh&#34;]
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>entrypoint.sh</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/sh
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">#/usr/sbin/keepalvined -n -l -D -f /etc/keepalived/keepalived.conf --dont-fork --log-console &amp;</span>
</span></span><span class="line"><span class="cl">/usr/sbin/keepalvined -D -f /etc/keepalived/keepalived.conf
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">nginx -g <span class="s2">&#34;daemon off;&#34;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>docker-compose.yml</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">version: &#34;3.1&#34;
</span></span><span class="line"><span class="cl">services:
</span></span><span class="line"><span class="cl">  nginx_master:
</span></span><span class="line"><span class="cl">    build:
</span></span><span class="line"><span class="cl">      context: ./
</span></span><span class="line"><span class="cl">      dockerfile: ./Dockerfile
</span></span><span class="line"><span class="cl">    ports:
</span></span><span class="line"><span class="cl">      -8081:80
</span></span><span class="line"><span class="cl">    volumes:
</span></span><span class="line"><span class="cl">      - ./index-master.html:/usr/share/nnginx/html/index.html
</span></span><span class="line"><span class="cl">      - ./favicon.ico:/usr/share/nnginx/html/favicon.ico
</span></span><span class="line"><span class="cl">      - ./keepalived-master.conf:/etv/keepalived/keepalived.conf
</span></span><span class="line"><span class="cl">    networks:
</span></span><span class="line"><span class="cl">      static-network:
</span></span><span class="line"><span class="cl">        ipv4_address:172.20.128.2
</span></span><span class="line"><span class="cl">    cap_add:
</span></span><span class="line"><span class="cl">      - NET_ADMIN
</span></span><span class="line"><span class="cl">  nginx_slave:
</span></span><span class="line"><span class="cl">    build:
</span></span><span class="line"><span class="cl">      context: ./
</span></span><span class="line"><span class="cl">      dockerfile: ./Dockerfile
</span></span><span class="line"><span class="cl">    ports:
</span></span><span class="line"><span class="cl">      -8082:80
</span></span><span class="line"><span class="cl">    volumes:
</span></span><span class="line"><span class="cl">      - ./index-slave.html:/usr/share/nnginx/html/index.html
</span></span><span class="line"><span class="cl">      - ./favicon.ico:/usr/share/nnginx/html/favicon.ico
</span></span><span class="line"><span class="cl">      - ./keepalived-slave.conf:/etv/keepalived/keepalived.conf
</span></span><span class="line"><span class="cl">    networks:
</span></span><span class="line"><span class="cl">      static-network:
</span></span><span class="line"><span class="cl">        ipv4_address:172.20.128.3
</span></span><span class="line"><span class="cl">    cap_add:
</span></span><span class="line"><span class="cl">      - NET_ADMIN
</span></span><span class="line"><span class="cl">  proxy:
</span></span><span class="line"><span class="cl">    image:  haproxy:1.7-apline
</span></span><span class="line"><span class="cl">    ports:
</span></span><span class="line"><span class="cl">      - 80:6301
</span></span><span class="line"><span class="cl">    volumes:
</span></span><span class="line"><span class="cl">      - ./happroxy.cfg:/usr/local/etc/haproxy/haproxy.cfg
</span></span><span class="line"><span class="cl">    networks:
</span></span><span class="line"><span class="cl">      - static-network
</span></span><span class="line"><span class="cl">networks:
</span></span><span class="line"><span class="cl">  static-network:
</span></span><span class="line"><span class="cl">    ipam:
</span></span><span class="line"><span class="cl">      congig:
</span></span><span class="line"><span class="cl">        - subnet: 172.20.0.0/16
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>keepalived-master.conf</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">vrrp_script chk_nginx {
</span></span><span class="line"><span class="cl">    script &#34;pidof nginx&#34;
</span></span><span class="line"><span class="cl">    interval 2
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vrrp_instance VI_1 {
</span></span><span class="line"><span class="cl">    state MASTER
</span></span><span class="line"><span class="cl">    interface etch0 # å®¹å™¨å†…éƒ¨çš„ç½‘å¡åç§°
</span></span><span class="line"><span class="cl">    virtual_router_id 33
</span></span><span class="line"><span class="cl">    priority 200    # ä¼˜å…ˆçº§
</span></span><span class="line"><span class="cl">    advert_int 1
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    autheentication {
</span></span><span class="line"><span class="cl">        auth_type PASS
</span></span><span class="line"><span class="cl">        auth_pass letmein
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    virtual_ipaddress {
</span></span><span class="line"><span class="cl">        172.20.128.50   # è™šæ‹Ÿè·¯å¾„
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    track_script {
</span></span><span class="line"><span class="cl">        chk_nginx
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>keepalived-slave.conf</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">vrrp_script chk_nginx {
</span></span><span class="line"><span class="cl">    script &#34;pidof nginx&#34;
</span></span><span class="line"><span class="cl">    interval 2
</span></span><span class="line"><span class="cl">}
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">vrrp_instance VI_1 {
</span></span><span class="line"><span class="cl">    state BACKUP
</span></span><span class="line"><span class="cl">    interface etch0 # å®¹å™¨å†…éƒ¨çš„ç½‘å¡åç§°
</span></span><span class="line"><span class="cl">    virtual_router_id 33
</span></span><span class="line"><span class="cl">    priority 100    # ä¼˜å…ˆçº§
</span></span><span class="line"><span class="cl">    advert_int 1
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    autheentication {
</span></span><span class="line"><span class="cl">        auth_type PASS
</span></span><span class="line"><span class="cl">        auth_pass letmein
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    virtual_ipaddress {
</span></span><span class="line"><span class="cl">        172.20.128.50   # è™šæ‹Ÿè·¯å¾„
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    track_script {
</span></span><span class="line"><span class="cl">        chk_nginx
</span></span><span class="line"><span class="cl">    }
</span></span><span class="line"><span class="cl">}
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>haproxy.cfg</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">global
</span></span><span class="line"><span class="cl">    log 127.0.0.1 local0
</span></span><span class="line"><span class="cl">    maxconn 4096
</span></span><span class="line"><span class="cl">    daemon
</span></span><span class="line"><span class="cl">    nbproc 4
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">defaults
</span></span><span class="line"><span class="cl">    log 127.0.0.1 local3
</span></span><span class="line"><span class="cl">    mode http
</span></span><span class="line"><span class="cl">    option dontlognull
</span></span><span class="line"><span class="cl">    option redispatch
</span></span><span class="line"><span class="cl">    retries 2
</span></span><span class="line"><span class="cl">    maxconn 2000
</span></span><span class="line"><span class="cl">    balance roundrobin
</span></span><span class="line"><span class="cl">    timeout connect 5000ms
</span></span><span class="line"><span class="cl">    timeout client 5000ms
</span></span><span class="line"><span class="cl">    timeout server 5000ms
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">frontend main
</span></span><span class="line"><span class="cl">    bind *:6301
</span></span><span class="line"><span class="cl">    default_backend webserver
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">backend webserveer
</span></span><span class="line"><span class="cl">    server nginx_master 127.20.127.50:80 check inter 2000 rise 2 fall 5
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="ä¸ƒå†…ç½®å˜é‡">ä¸ƒã€å†…ç½®å˜é‡</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">$args                    #è¯·æ±‚ä¸­çš„å‚æ•°å€¼
</span></span><span class="line"><span class="cl">$query_string            #åŒ $args
</span></span><span class="line"><span class="cl">$arg_NAME                #GETè¯·æ±‚ä¸­NAMEçš„å€¼
</span></span><span class="line"><span class="cl">$is_args                 #å¦‚æœè¯·æ±‚ä¸­æœ‰å‚æ•°ï¼Œå€¼ä¸º&#34;?&#34;ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²
</span></span><span class="line"><span class="cl">$uri                     #è¯·æ±‚ä¸­çš„å½“å‰URI(ä¸å¸¦è¯·æ±‚å‚æ•°ï¼Œå‚æ•°ä½äº$args)ï¼Œå¯ä»¥ä¸åŒäºæµè§ˆå™¨ä¼ é€’çš„$request_uriçš„å€¼ï¼Œå®ƒå¯ä»¥é€šè¿‡å†…éƒ¨é‡å®šå‘ï¼Œæˆ–è€…ä½¿ç”¨indexæŒ‡ä»¤è¿›è¡Œä¿®æ”¹ï¼Œ$uriä¸åŒ…å«ä¸»æœºåï¼Œå¦‚&#34;/foo/bar.html&#34;ã€‚
</span></span><span class="line"><span class="cl">$document_uri            #åŒ $uri
</span></span><span class="line"><span class="cl">$document_root           #å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«å
</span></span><span class="line"><span class="cl">$host                    #ä¼˜å…ˆçº§ï¼šHTTPè¯·æ±‚è¡Œçš„ä¸»æœºå&gt;&#34;HOST&#34;è¯·æ±‚å¤´å­—æ®µ&gt;ç¬¦åˆè¯·æ±‚çš„æœåŠ¡å™¨å.è¯·æ±‚ä¸­çš„ä¸»æœºå¤´å­—æ®µï¼Œå¦‚æœè¯·æ±‚ä¸­çš„ä¸»æœºå¤´ä¸å¯ç”¨ï¼Œåˆ™ä¸ºæœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æœåŠ¡å™¨åç§°
</span></span><span class="line"><span class="cl">$hostname                #ä¸»æœºå
</span></span><span class="line"><span class="cl">$https                   #å¦‚æœå¼€å¯äº†SSLå®‰å…¨æ¨¡å¼ï¼Œå€¼ä¸º&#34;on&#34;ï¼Œå¦åˆ™ä¸ºç©ºå­—ç¬¦ä¸²ã€‚
</span></span><span class="line"><span class="cl">$binary_remote_addr      #å®¢æˆ·ç«¯åœ°å€çš„äºŒè¿›åˆ¶å½¢å¼ï¼Œå›ºå®šé•¿åº¦ä¸º4ä¸ªå­—èŠ‚
</span></span><span class="line"><span class="cl">$body_bytes_sent         #ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°ï¼Œå“åº”å¤´ä¸è®¡ç®—åœ¨å†…ï¼›è¿™ä¸ªå˜é‡å’ŒApacheçš„mod_log_configæ¨¡å—ä¸­çš„&#34;%B&#34;å‚æ•°ä¿æŒå…¼å®¹
</span></span><span class="line"><span class="cl">$bytes_sent              #ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„å­—èŠ‚æ•°
</span></span><span class="line"><span class="cl">$connection              #TCPè¿æ¥çš„åºåˆ—å·
</span></span><span class="line"><span class="cl">$connection_requests     #TCPè¿æ¥å½“å‰çš„è¯·æ±‚æ•°é‡
</span></span><span class="line"><span class="cl">$content_length          #&#34;Content-Length&#34; è¯·æ±‚å¤´å­—æ®µ
</span></span><span class="line"><span class="cl">$content_type            #&#34;Content-Type&#34; è¯·æ±‚å¤´å­—æ®µ
</span></span><span class="line"><span class="cl">$cookie_name             #cookieåç§°
</span></span><span class="line"><span class="cl">$limit_rate              #ç”¨äºè®¾ç½®å“åº”çš„é€Ÿåº¦é™åˆ¶
</span></span><span class="line"><span class="cl">$msec                    #å½“å‰çš„Unixæ—¶é—´æˆ³
</span></span><span class="line"><span class="cl">$nginx_version           #nginxç‰ˆæœ¬
</span></span><span class="line"><span class="cl">$pid                     #å·¥ä½œè¿›ç¨‹çš„PID
</span></span><span class="line"><span class="cl">$pipe                    #å¦‚æœè¯·æ±‚æ¥è‡ªç®¡é“é€šä¿¡ï¼Œå€¼ä¸º&#34;p&#34;ï¼Œå¦åˆ™ä¸º&#34;.&#34;
</span></span><span class="line"><span class="cl">$proxy_protocol_addr     #è·å–ä»£ç†è®¿é—®æœåŠ¡å™¨çš„å®¢æˆ·ç«¯åœ°å€ï¼Œå¦‚æœæ˜¯ç›´æ¥è®¿é—®ï¼Œè¯¥å€¼ä¸ºç©ºå­—ç¬¦ä¸²
</span></span><span class="line"><span class="cl">$realpath_root           #å½“å‰è¯·æ±‚çš„æ–‡æ¡£æ ¹ç›®å½•æˆ–åˆ«åçš„çœŸå®è·¯å¾„ï¼Œä¼šå°†æ‰€æœ‰ç¬¦å·è¿æ¥è½¬æ¢ä¸ºçœŸå®è·¯å¾„
</span></span><span class="line"><span class="cl">$remote_addr             #å®¢æˆ·ç«¯åœ°å€
</span></span><span class="line"><span class="cl">$remote_port             #å®¢æˆ·ç«¯ç«¯å£
</span></span><span class="line"><span class="cl">$remote_user             #ç”¨äºHTTPåŸºç¡€è®¤è¯æœåŠ¡çš„ç”¨æˆ·å
</span></span><span class="line"><span class="cl">$request                 #ä»£è¡¨å®¢æˆ·ç«¯çš„è¯·æ±‚åœ°å€
</span></span><span class="line"><span class="cl">$request_body            #å®¢æˆ·ç«¯çš„è¯·æ±‚ä¸»ä½“ï¼šæ­¤å˜é‡å¯åœ¨locationä¸­ä½¿ç”¨ï¼Œå°†è¯·æ±‚ä¸»ä½“é€šè¿‡proxy_passï¼Œfastcgi_passï¼Œuwsgi_passå’Œscgi_passä¼ é€’ç»™ä¸‹ä¸€çº§çš„ä»£ç†æœåŠ¡å™¨
</span></span><span class="line"><span class="cl">$request_body_file       #å°†å®¢æˆ·ç«¯è¯·æ±‚ä¸»ä½“ä¿å­˜åœ¨ä¸´æ—¶æ–‡ä»¶ä¸­ã€‚æ–‡ä»¶å¤„ç†ç»“æŸåï¼Œæ­¤æ–‡ä»¶éœ€åˆ é™¤ã€‚å¦‚æœéœ€è¦ä¹‹ä¸€å¼€å¯æ­¤åŠŸèƒ½ï¼Œéœ€è¦è®¾ç½®client_body_in_file_onlyã€‚å¦‚æœå°†æ¬¡æ–‡ä»¶ä¼  é€’ç»™åç«¯çš„ä»£ç†æœåŠ¡å™¨ï¼Œéœ€è¦ç¦ç”¨request bodyï¼Œå³è®¾ç½®proxy_pass_request_body offï¼Œfastcgi_pass_request_body offï¼Œuwsgi_pass_request_body offï¼Œor scgi_pass_request_body off
</span></span><span class="line"><span class="cl">$request_completion      #å¦‚æœè¯·æ±‚æˆåŠŸï¼Œå€¼ä¸º&#34;OK&#34;ï¼Œå¦‚æœè¯·æ±‚æœªå®Œæˆæˆ–è€…è¯·æ±‚ä¸æ˜¯ä¸€ä¸ªèŒƒå›´è¯·æ±‚çš„æœ€åä¸€éƒ¨åˆ†ï¼Œåˆ™ä¸ºç©º
</span></span><span class="line"><span class="cl">$request_filename        #å½“å‰è¿æ¥è¯·æ±‚çš„æ–‡ä»¶è·¯å¾„ï¼Œç”±rootæˆ–aliasæŒ‡ä»¤ä¸URIè¯·æ±‚ç”Ÿæˆ
</span></span><span class="line"><span class="cl">$request_length          #è¯·æ±‚çš„é•¿åº¦ (åŒ…æ‹¬è¯·æ±‚çš„åœ°å€ï¼Œhttpè¯·æ±‚å¤´å’Œè¯·æ±‚ä¸»ä½“)
</span></span><span class="line"><span class="cl">$request_method          #HTTPè¯·æ±‚æ–¹æ³•ï¼Œé€šå¸¸ä¸º&#34;GET&#34;æˆ–&#34;POST&#34;
</span></span><span class="line"><span class="cl">$request_time            #å¤„ç†å®¢æˆ·ç«¯è¯·æ±‚ä½¿ç”¨çš„æ—¶é—´,å•ä½ä¸ºç§’ï¼Œç²¾åº¦æ¯«ç§’ï¼› ä»è¯»å…¥å®¢æˆ·ç«¯çš„ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹ï¼Œç›´åˆ°æŠŠæœ€åä¸€ä¸ªå­—ç¬¦å‘é€ç»™å®¢æˆ·ç«¯åè¿›è¡Œæ—¥å¿—å†™å…¥ä¸ºæ­¢ã€‚
</span></span><span class="line"><span class="cl">$request_uri             #è¿™ä¸ªå˜é‡ç­‰äºåŒ…å«ä¸€äº›å®¢æˆ·ç«¯è¯·æ±‚å‚æ•°çš„åŸå§‹URIï¼Œå®ƒæ— æ³•ä¿®æ”¹ï¼Œè¯·æŸ¥çœ‹$uriæ›´æ”¹æˆ–é‡å†™URIï¼Œä¸åŒ…å«ä¸»æœºåï¼Œä¾‹å¦‚ï¼š&#34;/cnphp/test.php?arg=freemouse&#34;
</span></span><span class="line"><span class="cl">$scheme                  #è¯·æ±‚ä½¿ç”¨çš„Webåè®®ï¼Œ&#34;http&#34; æˆ– &#34;https&#34;
</span></span><span class="line"><span class="cl">$server_addr             #æœåŠ¡å™¨ç«¯åœ°å€ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼šä¸ºäº†é¿å…è®¿é—®linuxç³»ç»Ÿå†…æ ¸ï¼Œåº”å°†ipåœ°å€æå‰è®¾ç½®åœ¨é…ç½®æ–‡ä»¶ä¸­
</span></span><span class="line"><span class="cl">$server_name             #æœåŠ¡å™¨å
</span></span><span class="line"><span class="cl">$server_port             #æœåŠ¡å™¨ç«¯å£
</span></span><span class="line"><span class="cl">$server_protocol         #æœåŠ¡å™¨çš„HTTPç‰ˆæœ¬ï¼Œé€šå¸¸ä¸º &#34;HTTP/1.0&#34; æˆ– &#34;HTTP/1.1&#34;
</span></span><span class="line"><span class="cl">$status                  #HTTPå“åº”ä»£ç 
</span></span><span class="line"><span class="cl">$time_iso8601            #æœåŠ¡å™¨æ—¶é—´çš„ISO 8610æ ¼å¼
</span></span><span class="line"><span class="cl">$time_local              #æœåŠ¡å™¨æ—¶é—´ï¼ˆLOG Format æ ¼å¼ï¼‰
</span></span><span class="line"><span class="cl">$cookie_NAME             #å®¢æˆ·ç«¯è¯·æ±‚Headerå¤´ä¸­çš„cookieå˜é‡ï¼Œå‰ç¼€&#34;$cookie_&#34;åŠ ä¸Šcookieåç§°çš„å˜é‡ï¼Œè¯¥å˜é‡çš„å€¼å³ä¸ºcookieåç§°çš„å€¼
</span></span><span class="line"><span class="cl">$http_NAME               #åŒ¹é…ä»»æ„è¯·æ±‚å¤´å­—æ®µï¼›å˜é‡åä¸­çš„ååŠéƒ¨åˆ†NAMEå¯ä»¥æ›¿æ¢æˆä»»æ„è¯·æ±‚å¤´å­—æ®µï¼Œå¦‚åœ¨é…ç½®æ–‡ä»¶ä¸­éœ€è¦è·å–httpè¯·æ±‚å¤´ï¼š&#34;Accept-Language&#34;ï¼Œ$http_accept_languageå³å¯
</span></span><span class="line"><span class="cl">$http_cookie
</span></span><span class="line"><span class="cl">$http_host               #è¯·æ±‚åœ°å€ï¼Œå³æµè§ˆå™¨ä¸­ä½ è¾“å…¥çš„åœ°å€ï¼ˆIPæˆ–åŸŸåï¼‰
</span></span><span class="line"><span class="cl">$http_referer            #urlè·³è½¬æ¥æº,ç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„
</span></span><span class="line"><span class="cl">$http_user_agent         #ç”¨æˆ·ç»ˆç«¯æµè§ˆå™¨ç­‰ä¿¡æ¯
</span></span><span class="line"><span class="cl">$http_x_forwarded_for
</span></span><span class="line"><span class="cl">$sent_http_NAME          #å¯ä»¥è®¾ç½®ä»»æ„httpå“åº”å¤´å­—æ®µï¼›å˜é‡åä¸­çš„ååŠéƒ¨åˆ†NAMEå¯ä»¥æ›¿æ¢æˆä»»æ„å“åº”å¤´å­—æ®µï¼Œå¦‚éœ€è¦è®¾ç½®å“åº”å¤´Content-lengthï¼Œ$sent_http_content_lengthå³å¯
</span></span><span class="line"><span class="cl">$sent_http_cache_control
</span></span><span class="line"><span class="cl">$sent_http_connection
</span></span><span class="line"><span class="cl">$sent_http_content_type
</span></span><span class="line"><span class="cl">$sent_http_keep_alive
</span></span><span class="line"><span class="cl">$sent_http_last_modified
</span></span><span class="line"><span class="cl">$sent_http_location
</span></span><span class="line"><span class="cl">$sent_http_transfer_encoding
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>æ›´æ–°äº 2022-07-01</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"><span>
                            <a class="link-to-markdown" href="/2022/07/01/nginx%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/index.md" target="_blank">é˜…è¯»åŸå§‹æ–‡æ¡£</a>
                        </span></div>
            <div class="post-info-share">
                <span></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/nginx/">Nginx</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">è¿”å›</a></span>&nbsp;|&nbsp;<span><a href="/">ä¸»é¡µ</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/2022/06/01/mybatisplus%E6%9D%A1%E4%BB%B6%E6%9E%84%E9%80%A0%E5%99%A8/" class="prev" rel="prev" title="MybatisPlusæ¡ä»¶æ„é€ å™¨"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>MybatisPlusæ¡ä»¶æ„é€ å™¨</a>
            <a href="/2022/12/26/%E9%9A%8F%E6%9C%BA%E5%9B%BE%E7%89%87api/" class="next" rel="next" title="éšæœºå›¾ç‰‡api">éšæœºå›¾ç‰‡api<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
</article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">ç”± <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.129.0">Hugo</a> å¼ºåŠ›é©±åŠ¨ | ä¸»é¢˜ - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://github.com/yuanwangshijie" target="_blank">è¿œæœ›ä¸–ç•Œ</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nc/4.0/" target="_blank">CC BY-NC 4.0</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="å›åˆ°é¡¶éƒ¨">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="æŸ¥çœ‹è¯„è®º">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/lightgallery/css/lightgallery-bundle.min.css"><link rel="stylesheet" href="/lib/katex/katex.min.css"><link rel="stylesheet" href="/lib/cookieconsent/cookieconsent.min.css"><script type="text/javascript" src="/lib/autocomplete/autocomplete.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.js"></script><script type="text/javascript" src="/lib/lazysizes/lazysizes.min.js"></script><script type="text/javascript" src="/lib/twemoji/twemoji.min.js"></script><script type="text/javascript" src="/lib/lightgallery/lightgallery.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/thumbnail/lg-thumbnail.min.js"></script><script type="text/javascript" src="/lib/lightgallery/plugins/zoom/lg-zoom.min.js"></script><script type="text/javascript" src="/lib/clipboard/clipboard.min.js"></script><script type="text/javascript" src="/lib/katex/katex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/auto-render.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/copy-tex.min.js"></script><script type="text/javascript" src="/lib/katex/contrib/mhchem.min.js"></script><script type="text/javascript" src="/lib/cookieconsent/cookieconsent.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"å¤åˆ¶åˆ°å‰ªè´´æ¿","maxShownLines":50},"comment":{},"cookieconsent":{"content":{"dismiss":"åŒæ„","link":"äº†è§£æ›´å¤š","message":"æœ¬ç½‘ç«™ä½¿ç”¨ Cookies æ¥æ”¹å–„æ‚¨çš„æµè§ˆä½“éªŒ."},"enable":true,"palette":{"button":{"background":"#f0f0f0"},"popup":{"background":"#1aa3ff"}},"theme":"edgeless"},"lightgallery":true,"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"æ²¡æœ‰æ‰¾åˆ°ç»“æœ","snippetLength":50,"type":"lunr"},"twemoji":true};</script><script type="text/javascript" src="/js/theme.min.js"></script></body>
</html>
